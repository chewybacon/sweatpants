import { createFileRoute } from '@tanstack/react-router'
import { createChatHandler } from '@tanstack/framework/handler'
import { getChatProvider, resolvePersona } from '@tanstack/framework/chat'

// Auto-discovered tools from src/tools/ (generated by @tanstack/framework)
import { toolList } from '../__generated__/tool-registry.gen'


// Combine all tools
const allTools = [
  ...toolList,
]

// Create the handler with all configuration
const chatHandler = createChatHandler({
  tools: allTools,
  provider: getChatProvider(),
  resolvePersona: resolvePersona,
})

export const Route = createFileRoute('/api/chat')({
  server: {
    handlers: {
      POST: async ({ request }) => chatHandler(request),
    },
  },
})
